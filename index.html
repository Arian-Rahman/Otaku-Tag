---
title: Otaku Tag - Genre Prediction
layout: page
---

<!-- Page Title -->
<h1 style="text-align: center; margin-bottom: 20px;">ðŸŽŒ Otaku Tag - Genre Prediction ðŸŽŒ</h1>

<!-- Instructions -->
<p style="text-align: center; font-size: 1.2em;">Enter a description of an anime or manga below, and let our AI model predict its genres!</p>

<hr>

<!-- Input Section -->
<h2 style="text-align: center;">ðŸ“š Enter Anime/Manga Description:</h2>
<p style="text-align: center; font-size: 1.1em;">Type a brief description of the anime or manga, and we will predict the genres associated with it.</p>

<!-- Description Input -->
<div style="margin-top: 20px; text-align: center;">
  <input id="description" type="text" placeholder="Enter description here..." style="font-size: 1.2em; padding: 10px; margin-bottom: 20px; width: 80%;">
</div>

<!-- Prediction Button -->
<div style="text-align: center;">
  <button onclick="predictGenres()" style="font-size: 1.2em; padding: 10px 20px; background-color: #4CAF50; color: white; border: none; border-radius: 5px; cursor: pointer;">Get Predicted Genres</button>
</div>

<!-- Result Section -->
<div id="result" style="display: flex; justify-content: center; align-items: center; margin-top: 40px; font-size: 1.3em;">
  <div style="border: 2px solid #ddd; padding: 20px; border-radius: 10px; width: 60%; text-align: center;">
    <!-- Predicted Genres -->
    <div id="predictedGenres" style="font-weight: bold; color: #444;"></div>
  </div>
</div>

<hr>

<!-- How It Works Section -->
<h2 style="text-align: center;">ðŸŽ¬ How It Works:</h2>
<ol style="text-align: center; font-size: 1.1em;">
  <li><strong>Enter a description</strong>: Type a brief description of an anime or manga.</li>
  <li><strong>Get a prediction</strong>: The model will predict the genres based on the description.</li>
  <li><strong>Explore more</strong>: Try different descriptions to explore more genres.</li>
</ol>
<p style="text-align: center;">Once you enter the description, the predicted genres will appear below.</p>

<script>
  async function predictGenres() {
      const description = document.getElementById("description").value.trim();

      if (!description) {
          alert("Please enter a description.");
          return;
      }

      const apiUrl = "https://soothsayer1221-otaku-tag.hf.space/gradio_api/call/predict"; 

      // Construct the request payload
      const requestData = {
          data: [description] // Ensure it's an array as expected by Gradio
      };

      try {
          // Send the initial request to trigger the prediction
          const response = await fetch(apiUrl, {
              method: "POST",
              headers: { "Content-Type": "application/json" },
              body: JSON.stringify(requestData)
          });

          const responseData = await response.json();
          const eventId = responseData.event_id;

          if (!eventId) {
              throw new Error("No event_id returned from the API.");
          }

          console.log("Event ID:", eventId);
          debugger
          // Poll the API to get the result using event_id
          const resultResponse = await pollForResult(eventId)
          debugger
          // Extract prediction result
          const predictedGenres = resultResponse?.data?.[0] || "No genres predicted.";

          // Display result
          document.getElementById("predictedGenres").innerText = `Predicted Genres: ${predictedGenres}`;
      } catch (error) {
          console.error("Error:", error);
          document.getElementById("predictedGenres").innerText = "Error fetching prediction.";
      }
  }

  // Function to poll the API until the result is ready
  async function pollForResult(eventId) {
    const pollUrl = `https://soothsayer1221-otaku-tag.hf.space/gradio_api/call/predict/${eventId}`;

    let result = null;

    // Poll the result every 2 seconds
    while (!result) {
        const response = await fetch(pollUrl);
        debugger
        // Check if the response is empty or not JSON
        const text = await response.text(); // Read response as text
        const jsonPart = text.split("data: ")[1]; // This should give the JSON part

        try {
            const data = JSON.parse(jsonPart); // Manually parse JSON
            debugger
            // Check if prediction is complete
            if (data?.status === "completed") {
                result = data;
            } else {
                console.log("Waiting for prediction...");
                await new Promise(resolve => setTimeout(resolve, 2000)); // Wait 2 seconds
            }
        } catch (error) {
            console.error("Error parsing JSON:", error);
            console.log("Response Text:", text); // Log raw response for debugging
            break;
        }
    }

    return result;
}
  
</script>